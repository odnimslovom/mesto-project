(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{nZ:()=>W,AS:()=>X,Gk:()=>V});const t=document.querySelectorAll(".popup"),o=document.querySelector(".profile"),r=o.querySelector(".profile__button_type_edit"),n=o.querySelector(".profile__name"),a=o.querySelector(".profile__status"),s=o.querySelector(".profile__button_type_add"),l=o.querySelector(".profile__avatar"),i=o.querySelector(".profile__avatar-edit"),c=document.querySelector(".popup_type_add-avatar"),p=c.querySelector(".popup__form"),u=c.querySelector(".popup__form-item_type_link"),d=c.querySelector(".popup__button_type_submit"),_={formElementClass:".popup__form",inputElementClass:".popup__form-input",buttonElementClass:".popup__button_type_submit",buttonInactiveElementClass:"popup__button_type_inactive",inputInvalidElementClass:".popup__form-item_type_invalid",errorActiveElementClass:"popup__form-error_type_active"},m=document.querySelector(".popup_type_edit-profile"),y=m.querySelector(".popup__form"),v=y.querySelector(".popup__form-item_type_name"),h=y.querySelector(".popup__form-item_type_status"),f=Array.from(m.querySelectorAll(_.inputElementClass)),E=m.querySelector(_.buttonElementClass),C=document.querySelector(".cards__list"),S=document.querySelector(".popup_type_add-card"),q=S.querySelector(".popup__form"),k=S.querySelector(".popup__form-item_type_name"),b=S.querySelector(".popup__form-item_type_link"),g=document.querySelector("#template__card").content,L=Array.from(S.querySelectorAll(_.inputElementClass)),x=S.querySelector(_.buttonElementClass),A=document.querySelector(".popup_type_show-image"),$=A.querySelector(".popup__image"),T=A.querySelector(".popup__text"),j="https://nomoreparties.co/v1/plus-cohort-9/",D="30ee5c2b-3c10-4367-af03-f8ff84e704e6",z=e=>{e.classList.add("popup_opened"),document.addEventListener("keydown",O)},P=e=>{e.classList.remove("popup_opened"),document.removeEventListener("keydown",O)},O=e=>{if("Escape"===e.key){const e=document.querySelector(".popup_opened");P(e)}};t.forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("popup_opened")&&P(e),t.target.classList.contains("popup__button_type_close")&&P(e)}))}));const w=e=>{e.querySelectorAll(".popup__form-error").forEach((t=>{e.contains(t)&&t.classList.remove("popup__form-error_type_active")}))},I=e=>{e.reset()},N=(e,t,o)=>{J(e)?(t.classList.add(o.buttonInactiveElementClass),t.disabled=!0):(t.classList.remove(o.buttonInactiveElementClass),t.disabled=!1)},J=e=>e.some((e=>!e.validity.valid)),H=(e,t,o)=>{t.validity.valid?M(e,t,o):G(e,t,t.validationMessage,o)},G=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputInvalidElementClass),n.textContent=o,n.classList.add(r.errorActiveElementClass)},M=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputInvalidElementClass),r.classList.remove(o.errorActiveElementClass),r.textContent=""},U=(e,t)=>{const o=B(e,t);C.prepend(o)},Z=(e,t,o)=>{t.textContent=o,e.classList.toggle("cards__like_active")},B=(e,t)=>{const o=g.querySelector(".cards__item").cloneNode(!0),r=o.querySelector(".cards__image"),n=o.querySelector(".cards__title"),a=o.querySelector(".cards__delete"),s=o.querySelector(".cards__like"),l=o.querySelector(".cards__like-counter");return r.src=e.link,r.alt=e.name,l.textContent=isNaN(e.likeCounter)?0:e.likeCounter,n.textContent=e.name,e.isDeletable||a.remove(),e.isLiked&&s.classList.add("cards__like_active"),r.addEventListener("click",F),a.addEventListener("click",(()=>W(t,o))),s.addEventListener("click",(()=>X(t,s,l))),o},F=e=>{$.src=e.target.src,$.alt=e.target.alt,T.textContent=e.target.alt,z(A)},K=e=>e.ok?e.json():Promise.reject(`Error ${e.status}`),Q=e=>{l.src=e},R=(e,t)=>{n.textContent=e,a.textContent=t},V=e=>{fetch(j+"cards",{headers:{authorization:D,"Content-Type":"application/json"}}).then(K).then((t=>{t.reverse().forEach((t=>{U({name:t.name,link:t.link,likeCounter:t.likes.length,isDeletable:t.owner._id===e,isLiked:void 0!==t.likes.find((t=>t._id===e))},t._id)}))})).catch((e=>console.log(`Error: ${e.message}!!!`)))},W=(e,t)=>{(e=>fetch(`https://nomoreparties.co/v1/plus-cohort-9/cards/${e}`,{method:"DELETE",headers:{authorization:D,"Content-Type":"application/json"}}).then((e=>{if(!e.ok)return Promise.reject(`Error ${e.status}`)})))(e).then((e=>{e.remove(),e=null})(t)).catch((e=>console.log(`Error: ${e.message}!!!`)))},X=(e,t,o)=>{t.classList.contains("cards__like_active")?(e=>fetch(`https://nomoreparties.co/v1/plus-cohort-9/cards/likes/${e}`,{method:"DELETE",headers:{authorization:D,"Content-Type":"application/json"}}).then(K))(e).then((e=>{Z(t,o,e.likes.length)})).catch((e=>console.log(`Error: ${e.message}!!!`))):(e=>fetch(`https://nomoreparties.co/v1/plus-cohort-9/cards/likes/${e}`,{method:"PUT",headers:{authorization:D,"Content-Type":"application/json"}}).then(K))(e).then((e=>{Z(t,o,e.likes.length)})).catch((e=>console.log(`Error: ${e.message}!!!`)))};r.addEventListener("click",(()=>{v.value,h.value,v.value=n.textContent,h.value=a.textContent,N(f,E,_),w(m),z(m)})),i.addEventListener("click",(()=>{N([u],d,_),w(c),z(c)})),s.addEventListener("click",(()=>{N(L,x,_),w(S),z(S)})),y.addEventListener("submit",(e=>{var t,o;e.preventDefault(),E.textContent="Сохранение...",(t=v.value,o=h.value,fetch(j+"users/me",{method:"PATCH",headers:{authorization:D,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:o})}).then(K)).then((e=>{R(e.name,e.about),P(m)})).catch((e=>{console.log(`Error: ${e.message}!!!`)})).finally((()=>{E.textContent="Сохранить"}))})),q.addEventListener("submit",(e=>{var t,o;e.preventDefault(),x.textContent="Сохранение...",(t=k.value,o=b.value,fetch(j+"cards",{method:"POST",headers:{authorization:D,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:o})}).then(K)).then((e=>{U({name:e.name,link:e.link,isDeletable:!0},e._id),P(S)})).catch((e=>console.log(`Error: ${e.message}!!!`))).finally((()=>{I(q),x.textContent="Сохранить"}))})),c.addEventListener("submit",(e=>{var t;e.preventDefault(),d.textContent="Сохранение...",(t=u.value,fetch(j+"users/me/avatar",{method:"PATCH",headers:{authorization:D,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(K)).then((e=>{Q(e.avatar),P(c)})).catch((e=>{console.log(`Error: ${e.message}!!!`)})).finally((()=>{d.textContent="Сохранить",I(p)}))})),fetch(j+"users/me",{headers:{authorization:D}}).then(K).then((e=>{const t=e._id;R(e.name,e.about),Q(e.avatar),V(t)})).catch((e=>console.log(`Error: ${e.message}!!!`))),(e=>{Array.from(document.querySelectorAll(e.formElementClass)).forEach((t=>{t.addEventListener("submit",(function(e){e.preventDefault()})),((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputElementClass)),r=e.querySelector(t.buttonElementClass);N(o,r,t),o.forEach((n=>{n.addEventListener("input",(function(){H(e,n,t),N(o,r,t)}))}))})(t,e)}))})(_)})();