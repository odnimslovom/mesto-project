(()=>{"use strict";const e=document.querySelectorAll(".popup"),t=document.querySelector(".profile"),o=t.querySelector(".profile__button_type_edit"),r=t.querySelector(".profile__name"),n=t.querySelector(".profile__status"),a=t.querySelector(".profile__button_type_add"),s=t.querySelector(".profile__avatar"),l=t.querySelector(".profile__avatar-edit"),i=document.querySelector(".popup_type_add-avatar"),c=i.querySelector(".popup__form"),p=i.querySelector(".popup__form-item_type_link"),u=i.querySelector(".popup__button_type_submit"),d={formElementClass:".popup__form",inputElementClass:".popup__form-input",buttonElementClass:".popup__button_type_submit",buttonInactiveElementClass:"popup__button_type_inactive",inputInvalidElementClass:".popup__form-item_type_invalid",errorActiveElementClass:"popup__form-error_type_active"},_=document.querySelector(".popup_type_edit-profile"),m=_.querySelector(".popup__form"),y=m.querySelector(".popup__form-item_type_name"),v=m.querySelector(".popup__form-item_type_status"),h=Array.from(_.querySelectorAll(d.inputElementClass)),f=_.querySelector(d.buttonElementClass),E=document.querySelector(".cards__list"),C=document.querySelector(".popup_type_add-card"),S=C.querySelector(".popup__form"),q=C.querySelector(".popup__form-item_type_name"),k=C.querySelector(".popup__form-item_type_link"),g=document.querySelector("#template__card").content,L=Array.from(C.querySelectorAll(d.inputElementClass)),b=C.querySelector(d.buttonElementClass),x=document.querySelector(".popup_type_show-image"),A=x.querySelector(".popup__image"),$=x.querySelector(".popup__text"),T="https://nomoreparties.co/v1/plus-cohort-9/",j="30ee5c2b-3c10-4367-af03-f8ff84e704e6";e.forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("popup_opened")&&D(e),t.target.classList.contains("popup__button_type_close")&&D(e)}))}));const z=e=>{e.classList.add("popup_opened"),document.addEventListener("keydown",I)},D=e=>{e.classList.remove("popup_opened"),document.removeEventListener("keydown",I)},I=e=>{if("Escape"===e.key){const e=document.querySelector(".popup_opened");D(e)}},N=e=>{e.querySelectorAll(".popup__form-error").forEach((t=>{e.contains(t)&&t.classList.remove("popup__form-error_type_active")}))},P=e=>{e.reset()},w=e=>e.ok?e.json():Promise.reject(`Error ${e.status}`),O=(e,t,o)=>{J(e)?(t.classList.add(o.buttonInactiveElementClass),t.disabled=!0):(t.classList.remove(o.buttonInactiveElementClass),t.disabled=!1)},J=e=>e.some((e=>!e.validity.valid)),H=(e,t,o)=>{t.validity.valid?U(e,t,o):M(e,t,t.validationMessage,o)},M=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputInvalidElementClass),n.textContent=o,n.classList.add(r.errorActiveElementClass)},U=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputInvalidElementClass),r.classList.remove(o.errorActiveElementClass),r.textContent=""},B=(e,t)=>{const o=F(e,t);E.prepend(o)},F=(e,t)=>{const o=g.querySelector(".cards__item").cloneNode(!0),r=o.querySelector(".cards__image"),n=o.querySelector(".cards__title"),a=o.querySelector(".cards__delete"),s=o.querySelector(".cards__like"),l=o.querySelector(".cards__like-counter");return r.src=e.link,r.alt=e.name,l.textContent=isNaN(e.likeCounter)?0:e.likeCounter,n.textContent=e.name,e.isDeletable||a.remove(),e.isLiked&&s.classList.add("cards__like_active"),r.addEventListener("click",G),a.addEventListener("click",(function(e){(e=>fetch(`https://nomoreparties.co/v1/plus-cohort-9/cards/${e}`,{method:"DELETE",headers:{authorization:j,"Content-Type":"application/json"}}).then((e=>{if(!e.ok)return Promise.reject(`Error ${e.status}`)})))(t).then((()=>{e.target.closest(".cards__item").remove()})).catch((e=>console.log(`Error: ${e.message}!!!`)))})),s.addEventListener("click",(function(e){s.classList.contains("cards__like_active")?(e=>fetch(`https://nomoreparties.co/v1/plus-cohort-9/cards/likes/${e}`,{method:"DELETE",headers:{authorization:j,"Content-Type":"application/json"}}).then(w))(t).then((t=>{l.textContent=t.likes.length,e.target.classList.remove("cards__like_active")})).catch((e=>console.log(`Error: ${e.message}!!!`))):(e=>fetch(`https://nomoreparties.co/v1/plus-cohort-9/cards/likes/${e}`,{method:"PUT",headers:{authorization:j,"Content-Type":"application/json"}}).then(w))(t).then((t=>{l.textContent=t.likes.length,e.target.classList.add("cards__like_active")})).catch((e=>console.log(`Error: ${e.message}!!!`)))})),o},G=e=>{A.src=e.target.src,A.alt=e.target.alt,$.textContent=e.target.alt,z(x)},K=e=>{s.src=e},Q=(e,t)=>{r.textContent=e,n.textContent=t};o.addEventListener("click",(()=>{y.value,v.value,y.value=r.textContent,v.value=n.textContent,O(h,f,d),N(_),z(_)})),l.addEventListener("click",(()=>{O([p],u,d),N(i),z(i)})),a.addEventListener("click",(()=>{O(L,b,d),N(C),z(C)})),m.addEventListener("submit",(e=>{var t,o;e.preventDefault(),f.textContent="Сохранение...",(t=y.value,o=v.value,fetch(T+"users/me",{method:"PATCH",headers:{authorization:j,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:o})}).then(w)).then((e=>{Q(e.name,e.about),D(_)})).catch((e=>{console.log(`Error: ${e.message}!!!`)})).finally((()=>{f.textContent="Сохранить"}))})),S.addEventListener("submit",(e=>{var t,o;e.preventDefault(),b.textContent="Сохранение...",(t=q.value,o=k.value,fetch(T+"cards",{method:"POST",headers:{authorization:j,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:o})}).then(w)).then((e=>{B({name:e.name,link:e.link}),D(C)})).catch((e=>console.log(`Error: ${e.message}!!!`))).finally((()=>{P(S),b.textContent="Сохранить"}))})),i.addEventListener("submit",(e=>{var t;e.preventDefault(),u.textContent="Сохранение...",(t=p.value,fetch(T+"users/me/avatar",{method:"PATCH",headers:{authorization:j,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(w)).then((e=>{K(e.avatar),D(i)})).catch((e=>{console.log(`Error: ${e.message}!!!`)})).finally((()=>{u.textContent="Сохранить",P(c)}))})),fetch(T+"users/me",{headers:{authorization:j}}).then(w).then((e=>{let t=e._id;Q(e.name,e.about),K(e.avatar),(e=>{fetch(T+"cards",{headers:{authorization:j,"Content-Type":"application/json"}}).then(w).then((t=>{t.reverse().forEach((t=>{B({name:t.name,link:t.link,likeCounter:t.likes.length,isDeletable:t.owner._id===e,isLiked:void 0!==t.likes.find((t=>t._id===e))},t._id)}))})).catch((e=>console.log(`Error: ${e.message}!!!`)))})(t)})).catch((e=>console.log(`Error: ${e.message}!!!`))),(e=>{Array.from(document.querySelectorAll(e.formElementClass)).forEach((t=>{t.addEventListener("submit",(function(e){e.preventDefault()})),((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputElementClass)),r=e.querySelector(t.buttonElementClass);O(o,r,t),o.forEach((n=>{n.addEventListener("input",(function(){H(e,n,t),O(o,r,t)}))}))})(t,e)}))})(d)})();